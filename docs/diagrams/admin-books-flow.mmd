%%{init: {'theme':'base', 'themeVariables': { 'primaryColor':'#6366f1'}}}%%
flowchart TD
    Start([Books Management]) --> ListBooks[GET /api/books<br/>Display all books with<br/>search & filter]
    
    ListBooks --> Action{Select Action}
    
    %% Add Book
    Action -->|Add New Book| AddForm[Fill Book Form:<br/>- Title, Author<br/>- Category, Description<br/>- Price, Stock<br/>- Upload Image]
    AddForm --> ValidateAdd{Validate Form}
    ValidateAdd -->|Invalid| ShowError1[Show Validation Errors]
    ShowError1 --> AddForm
    
    ValidateAdd -->|Valid| UploadImage[POST /api/upload<br/>Upload image to MinIO]
    UploadImage --> CreateBook[POST /api/books<br/>Create new book record]
    CreateBook --> InsertDB[INSERT INTO books]
    InsertDB --> Success1[Show Success Toast]
    Success1 --> ListBooks
    
    %% Edit Book
    Action -->|Edit Book| LoadBook[GET /api/books/:id<br/>Load book data to form]
    LoadBook --> EditForm[Edit Book Form<br/>Modify fields]
    EditForm --> ValidateEdit{Validate Changes}
    ValidateEdit -->|Invalid| ShowError2[Show Validation Errors]
    ShowError2 --> EditForm
    
    ValidateEdit -->|Valid| CheckImage{New Image<br/>uploaded?}
    CheckImage -->|Yes| UploadNewImage[POST /api/upload<br/>Upload to MinIO]
    CheckImage -->|No| UpdateBook
    UploadNewImage --> UpdateBook[PUT /api/books/:id<br/>Update book record]
    UpdateBook --> UpdateDB[UPDATE books SET ...]
    UpdateDB --> Success2[Show Success Toast]
    Success2 --> ListBooks
    
    %% Delete Book
    Action -->|Delete Book| ConfirmDialog[Show ConfirmDialog:<br/>'Bạn có chắc chắn<br/>muốn xóa sách này?']
    ConfirmDialog --> ConfirmChoice{Confirm?}
    ConfirmChoice -->|No| ListBooks
    ConfirmChoice -->|Yes| DeleteBook[DELETE /api/books/:id]
    DeleteBook --> DeleteDB[DELETE FROM books<br/>WHERE id = ?]
    DeleteDB --> Success3[Show Success Toast]
    Success3 --> ListBooks
    
    %% Search & Filter
    Action -->|Search/Filter| SearchForm[Enter:<br/>- Search keyword<br/>- Category filter<br/>- Sort by]
    SearchForm --> SearchAPI[GET /api/books?<br/>search=...&category=...]
    SearchAPI --> FilterResults[Display filtered results]
    FilterResults --> ListBooks
    
    Action -->|Back| Back([Return to Dashboard])
    
    style Start fill:#e1f5e1
    style Back fill:#ffe1e1
    style ValidateAdd fill:#fff4e1
    style ValidateEdit fill:#fff4e1
    style ConfirmChoice fill:#fff4e1
    style CheckImage fill:#fff4e1
    style Success1 fill:#d1fae5
    style Success2 fill:#d1fae5
    style Success3 fill:#d1fae5


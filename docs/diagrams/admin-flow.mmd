flowchart TD
    Start([Admin/Staff User]) --> AdminLogin[Go to /admin/login]
    AdminLogin --> EnterCreds[Enter Username/Password]
    EnterCreds --> LoginAPI[POST /api/login]
    
    LoginAPI --> CheckRole{Role is<br/>admin or staff?}
    CheckRole -->|No| Denied[403 Forbidden<br/>Access Denied]
    Denied --> AdminLogin
    
    CheckRole -->|Yes| CreateSession[Create Session]
    CreateSession --> Dashboard[Redirect to<br/>/admin Dashboard]
    
    Dashboard --> Menu{Select Menu}
    
    %% Books Management
    Menu -->|Quản Lý Sách| BooksList[GET /api/books<br/>Display all books]
    BooksList --> BooksAction{Action?}
    
    BooksAction -->|Add Book| AddBookForm[Fill book form]
    AddBookForm --> PostBook[POST /api/books]
    PostBook --> ValidateBook{Valid data?}
    ValidateBook -->|No| ShowError1[Show validation errors]
    ShowError1 --> AddBookForm
    ValidateBook -->|Yes| InsertBook[INSERT INTO books]
    InsertBook --> BooksList
    
    BooksAction -->|Edit Book| EditBookForm[Load & edit book]
    EditBookForm --> PutBook[PUT /api/books/:id]
    PutBook --> UpdateBook[UPDATE books]
    UpdateBook --> BooksList
    
    BooksAction -->|Delete Book| ConfirmDel1{Confirm?}
    ConfirmDel1 -->|Yes| DelBook[DELETE /api/books/:id]
    DelBook --> RemoveBook[DELETE FROM books]
    RemoveBook --> BooksList
    ConfirmDel1 -->|No| BooksList
    
    BooksAction -->|Back| Dashboard
    
    %% Customer Management
    Menu -->|Quản Lý KH| CustomerList[GET /api/admin/users<br/>Filter role=customer]
    CustomerList --> CustomerAction{Action?}
    
    CustomerAction -->|Add Customer| AddCustForm[Fill customer form]
    AddCustForm --> PostCust[POST /api/register<br/>role=customer]
    PostCust --> GenCode[Auto-generate<br/>customer_code KH00X]
    GenCode --> InsertCust[INSERT INTO users]
    InsertCust --> CustomerList
    
    CustomerAction -->|Toggle Status| ToggleCust[PUT /api/admin/users/:id/status]
    ToggleCust --> UpdateActive[UPDATE is_active]
    UpdateActive --> CustomerList
    
    CustomerAction -->|Back| Dashboard
    
    %% Staff Management
    Menu -->|Quản Lý NV| StaffList[GET /api/admin/users<br/>Filter role=staff]
    StaffList --> StaffAction{Action?}
    
    StaffAction -->|Add Staff| AddStaffForm[Fill staff form]
    AddStaffForm --> PostStaff[POST /api/register<br/>role=staff]
    PostStaff --> GenStaffCode[Auto-generate<br/>staff_code NV00X]
    GenStaffCode --> InsertStaff[INSERT INTO users]
    InsertStaff --> StaffList
    
    StaffAction -->|Toggle Status| ToggleStaff[PUT /api/admin/users/:id/status]
    ToggleStaff --> UpdateStaffActive[UPDATE is_active]
    UpdateStaffActive --> StaffList
    
    StaffAction -->|Back| Dashboard
    
    %% Orders Management
    Menu -->|Quản Lý Hóa Đơn| OrdersList[GET /api/admin/orders<br/>Display all orders]
    OrdersList --> OrdersAction{Action?}
    
    OrdersAction -->|View Details| OrderDetail[GET /api/orders/:id<br/>Show order items]
    OrderDetail --> OrdersList
    
    OrdersAction -->|Update Status| SelectStatus[Select new status:<br/>pending → confirmed<br/>confirmed → completed<br/>any → cancelled]
    SelectStatus --> PutStatus[PUT /api/admin/orders/:id]
    PutStatus --> UpdateStatus[UPDATE orders<br/>SET status=new_status]
    UpdateStatus --> OrdersList
    
    OrdersAction -->|Back| Dashboard
    
    %% Banners Management
    Menu -->|Quản Lý Banner| BannerList[GET /api/banners?position=all]
    BannerList --> BannerAction{Action?}
    
    BannerAction -->|Add| AddBannerForm[Fill banner form<br/>title, image, position]
    AddBannerForm --> PostBanner[POST /api/banners]
    PostBanner --> InsertBanner[INSERT INTO banners]
    InsertBanner --> BannerList
    
    BannerAction -->|Edit| EditBanner[PUT /api/banners/:id]
    EditBanner --> UpdateBanner[UPDATE banners]
    UpdateBanner --> BannerList
    
    BannerAction -->|Toggle Active| ToggleBanner[PUT /api/banners/:id/status]
    ToggleBanner --> UpdateBannerActive[UPDATE is_active]
    UpdateBannerActive --> BannerList
    
    BannerAction -->|Delete| DelBanner[DELETE /api/banners/:id]
    DelBanner --> RemoveBanner[DELETE FROM banners]
    RemoveBanner --> BannerList
    
    BannerAction -->|Back| Dashboard
    
    %% Statistics
    Menu -->|Thống Kê| StatsPage[GET /api/admin/statistics]
    StatsPage --> FetchStats[Fetch:<br/>- Total revenue<br/>- Orders by status<br/>- Top 10 books]
    FetchStats --> RenderStats[Display:<br/>- Overview cards<br/>- Status chart<br/>- Top books grid]
    RenderStats --> StatsBack{Back?}
    StatsBack -->|Yes| Dashboard
    
    %% Logout
    Menu -->|Logout| LogoutAPI[POST /api/logout]
    LogoutAPI --> ClearSession[Clear session]
    ClearSession --> RedirectAdminLogin[Redirect to<br/>/admin/login]
    RedirectAdminLogin --> End([End])
    
    style Start fill:#e1f5e1
    style End fill:#ffe1e1
    style Dashboard fill:#f0e1ff
    style CheckRole fill:#fff4e1
    style ValidateBook fill:#fff4e1


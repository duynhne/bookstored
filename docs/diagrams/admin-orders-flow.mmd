%%{init: {'theme':'base', 'themeVariables': { 'primaryColor':'#6366f1'}}}%%
flowchart TD
    Start([Orders Management]) --> ListOrders[GET /api/admin/orders<br/>Display all orders]
    
    ListOrders --> Action{Select Action}
    
    %% View Order Details
    Action -->|View Details| ViewDetail[GET /api/orders/:id<br/>Fetch order with items]
    ViewDetail --> ShowDetail[Display Modal:<br/>- Order ID, Date<br/>- Customer info<br/>- Order items list<br/>- Total amount<br/>- Status, Payment Status<br/>- Shipping address]
    ShowDetail --> CloseModal{Close?}
    CloseModal -->|Yes| ListOrders
    
    %% Update Order Status
    Action -->|Update Status| SelectOrder[Select Order]
    SelectOrder --> ShowStatusModal[Show Status Modal:<br/>Current Status:<br/>- Pending<br/>- Confirmed<br/>- Completed<br/>- Cancelled]
    ShowStatusModal --> SelectNewStatus[Select New Status]
    SelectNewStatus --> ConfirmStatus{Confirm Change?}
    ConfirmStatus -->|No| ListOrders
    
    ConfirmStatus -->|Yes| UpdateStatus[PUT /api/admin/orders/:id<br/>Update order status]
    UpdateStatus --> UpdateDB1[UPDATE orders<br/>SET status = new_status]
    UpdateDB1 --> SuccessStatus[Show Success Toast]
    SuccessStatus --> ListOrders
    
    %% Update Payment Status
    Action -->|Update Payment| SelectOrderPay[Select Order]
    SelectOrderPay --> ShowPayModal[Show Payment Modal:<br/>Current: Pending/Paid]
    ShowPayModal --> SelectPayStatus[Select Status:<br/>- Pending - Chưa TT<br/>- Paid - Đã TT]
    SelectPayStatus --> ConfirmPay{Confirm?}
    ConfirmPay -->|No| ListOrders
    
    ConfirmPay -->|Yes| UpdatePayment[PUT /api/admin/orders/:id<br/>Update payment_status]
    UpdatePayment --> UpdateDB2[UPDATE orders<br/>SET payment_status = new_status]
    UpdateDB2 --> SuccessPay[Show Success Toast]
    SuccessPay --> ListOrders
    
    %% Filter Orders
    Action -->|Filter| FilterForm[Select Filters:<br/>- Status<br/>- Date range<br/>- Customer]
    FilterForm --> FilterAPI[GET /api/admin/orders?<br/>status=...&date=...]
    FilterAPI --> ShowFiltered[Display filtered results]
    ShowFiltered --> ListOrders
    
    Action -->|Back| Back([Return to Dashboard])
    
    style Start fill:#e1f5e1
    style Back fill:#ffe1e1
    style ConfirmStatus fill:#fff4e1
    style ConfirmPay fill:#fff4e1
    style SuccessStatus fill:#d1fae5
    style SuccessPay fill:#d1fae5
    style ShowDetail fill:#dbeafe
    style ShowStatusModal fill:#fef3c7
    style ShowPayModal fill:#fef3c7

